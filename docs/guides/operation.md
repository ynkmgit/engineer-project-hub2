# 運用ガイド

## 1. システム監視

### リソース監視
- CPU使用率
- メモリ使用率
- ディスク使用率
- ネットワークトラフィック

### アプリケーション監視
- API応答時間
- エラー率
- アクティブユーザー数
- データベースのコネクション数

## 2. バックアップ

### データベースバックアップ
```bash
# 手動バックアップの実行
pg_dump -U postgres -d project_e > backup.sql

# バックアップのリストア
psql -U postgres -d project_e < backup.sql
```

### バックアップスケジュール
- 毎日：差分バックアップ
- 毎週：フルバックアップ
- 毎月：アーカイブ

## 3. エラー対応

### よくあるエラーと対処方法

1. データベース接続エラー
```
エラー: relation "engineers" does not exist
対処: マイグレーションの実行
```

2. API タイムアウト
```
エラー: 504 Gateway Timeout
対処: 
- タイムアウト設定の確認
- クエリの最適化
```

3. メモリ不足
```
エラー: Out of memory
対処:
- 不要なプロセスの終了
- スワップ領域の確認
```

### ログの確認
```bash
# アプリケーションログ
docker-compose logs -f backend

# データベースログ
docker-compose logs -f db
```

## 4. 性能チューニング

### データベース
- インデックスの最適化
- クエリの最適化
- コネクションプールの調整

### アプリケーション
- キャッシュの活用
- N+1問題の解消
- バッチ処理の最適化

## 5. セキュリティ対策

### 定期的な作業
- セキュリティアップデートの適用
- 脆弱性スキャンの実施
- アクセスログの監査

### インシデント対応
1. 検知
2. 一時対応（影響の局所化）
3. 原因究明
4. 恒久対応
5. 再発防止策の実施

## 6. メンテナンス作業

### 定期メンテナンス
- OS updates
- セキュリティパッチの適用
- 依存パッケージの更新
- ログローテーション

### 計画停止の手順
1. ユーザーへの通知
2. アクセス制限の設定
3. プロセスの正常終了
4. バックアップの取得
5. メンテナンス作業の実施
6. 動作確認
7. サービスの再開

## 7. スケーリング

### スケールアップ
- CPU/メモリの増設
- ディスク容量の増設

### スケールアウト
- リードレプリカの追加
- アプリケーションサーバーの増設

## 8. 監視設定

### アラート閾値
- CPU使用率: 80%以上
- メモリ使用率: 85%以上
- ディスク使用率: 90%以上
- レスポンスタイム: 2秒以上

### 通知設定
- メール通知
- Slack通知
- オンコール担当者への通知